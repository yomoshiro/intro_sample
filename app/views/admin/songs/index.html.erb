<div class="container container-wide">
  <div class="admin-screen">
    <h1 class="title">曲管理</h1>

    <div class="admin-actions">
      <%= link_to "新しい曲を追加", new_admin_song_path, class: "btn btn-primary" %>
    </div>

    <div class="search-section">
      <%= form_with url: admin_songs_path, method: :get, local: true, class: "search-form" do |f| %>
        <%= f.text_field :q, value: params[:q], placeholder: "曲名、アーティスト、歌詞で検索...", class: "search-input-admin" %>
        <%= f.submit "検索", class: "btn btn-secondary btn-small" %>
        <% if params[:q].present? %>
          <%= link_to "クリア", admin_songs_path, class: "btn btn-secondary btn-small" %>
        <% end %>
      <% end %>
    </div>

    <% if notice %>
      <div class="notice"><%= notice %></div>
    <% end %>

    <div class="songs-table">
      <table>
        <thead>
          <tr>
            <th>
              <%= link_to admin_songs_path(sort: 'title', direction: params[:sort] == 'title' && params[:direction] == 'asc' ? 'desc' : 'asc', q: params[:q]) do %>
                曲名 <%= params[:sort] == 'title' ? (params[:direction] == 'asc' ? '▲' : '▼') : '' %>
              <% end %>
            </th>
            <th>
              <%= link_to admin_songs_path(sort: 'furigana', direction: params[:sort] == 'furigana' && params[:direction] == 'asc' ? 'desc' : 'asc', q: params[:q]) do %>
                ふりがな <%= params[:sort] == 'furigana' ? (params[:direction] == 'asc' ? '▲' : '▼') : '' %>
              <% end %>
            </th>
            <th>
              <%= link_to admin_songs_path(sort: 'artist', direction: params[:sort] == 'artist' && params[:direction] == 'asc' ? 'desc' : 'asc', q: params[:q]) do %>
                アーティスト <%= params[:sort] == 'artist' ? (params[:direction] == 'asc' ? '▲' : '▼') : '' %>
              <% end %>
            </th>
            <th>歌詞</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <% @songs.each do |song| %>
            <tr>
              <td><%= song.title %></td>
              <td><%= song.furigana %></td>
              <td><%= song.artist %></td>
              <td class="lyrics-preview"><%= truncate(song.lyrics, length: 50) %></td>
              <td class="actions">
                <%= link_to "編集", edit_admin_song_path(song), class: "btn btn-small" %>
                <%= button_to "削除", admin_song_path(song), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-small btn-danger" %>
              </td>
            </tr>
          <% end %>

          <% if @songs.empty? %>
            <tr>
              <td colspan="5" class="no-records">曲がまだ登録されていません</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
